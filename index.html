<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–µ–æ–Ω–æ–≤–æ–µ –ª–∞–π–≤-—Ä–∏—Å–æ–≤–∞–Ω–∏–µ ‚ú¶ —Ä–æ–∑–æ–≤—ã–π –Ω–∞ —á–µ—Ä–Ω–æ–º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0b0b0f;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        .neon-container {
            background: #111118;
            padding: 1.5rem 2rem 2rem 2rem;
            border-radius: 3rem 3rem 2rem 2rem;
            box-shadow: 0 0 30px #ff44cc88, 0 0 10px #ff66aa, inset 0 0 8px #ffaaff;
            border: 2px solid #ff66bb;
        }

        .canvas-wrapper {
            display: flex;
            justify-content: center;
            border-radius: 2.2rem;
            overflow: hidden;
            box-shadow: 0 0 40px #ff33aa, 0 0 20px #ff77bb inset;
            background: black;
        }

        canvas {
            display: block;
            width: 600px;
            height: 400px;
            cursor: crosshair;
            background: black;
            touch-action: none;  /* –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É–¥–æ–±—Å—Ç–≤–∞ */
        }

        .live-badge {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.2rem 0 0.8rem 0;
            color: #ffc1e0;
            text-shadow: 0 0 5px #ff66b2, 0 0 12px #ff3399;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .live-badge span {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pulse-dot {
            width: 14px;
            height: 14px;
            background: #ff3388;
            border-radius: 50%;
            box-shadow: 0 0 15px #ff66b2;
            animation: pulse 1.4s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; transform: scale(0.9); }
            50% { opacity: 1; transform: scale(1.2); background: #ff88cc; box-shadow: 0 0 25px #ffaaff; }
            100% { opacity: 0.6; transform: scale(0.9); }
        }

        button {
            background: transparent;
            border: 2.5px solid #ff44aa;
            color: #ffb6e6;
            font-size: 1.4rem;
            font-weight: bold;
            padding: 0.6rem 2.2rem;
            border-radius: 3rem;
            cursor: pointer;
            backdrop-filter: blur(2px);
            box-shadow: 0 0 20px #ff44aa, 0 0 8px #ff88dd inset;
            text-transform: uppercase;
            letter-spacing: 3px;
            transition: 0.2s;
            text-shadow: 0 0 6px #ff44aa;
        }

        button:hover {
            background: #ff339922;
            border-color: #ffaaff;
            color: #ffffff;
            box-shadow: 0 0 35px #ff88ff, 0 0 60px #ff44cc;
            transform: scale(1.02);
        }

        button:active {
            transform: scale(0.98);
        }

        .info-note {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.2rem;
            color: #ff77bb;
            font-size: 0.9rem;
            text-shadow: 0 0 4px currentColor;
        }

        .info-note i {
            font-style: normal;
            filter: drop-shadow(0 0 6px #ff55aa);
        }
    </style>
</head>
<body>
    <div class="neon-container">
        <div class="canvas-wrapper">
            <canvas id="sharedCanvas" width="600" height="400"></canvas>
        </div>

        <div class="live-badge">
            <span>
                <span class="pulse-dot"></span> LIVE ¬∑ —Ä–∏—Å—É—é—Ç –≤—Å–µ
            </span>
            <span>‚ú¶ —Ä–æ–∑–æ–≤—ã–π –Ω–µ–æ–Ω ‚ú¶</span>
        </div>

        <div style="display: flex; justify-content: center;">
            <button id="clearButton">‚úß –û–ß–ò–°–¢–ò–¢–¨ ‚úß</button>
        </div>

        <div class="info-note">
            <i>‚úé –Ω–∞–∂–∏–º–∞–π –∏ –≤–æ–¥–∏</i>
            <i>‚ö° –≤—Å—ë —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ</i>
        </div>
    </div>

    <script>
        (function() {
            const canvas = document.getElementById('sharedCanvas');
            const ctx = canvas.getContext('2d');

            // --- –Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞: —á–µ—Ä–Ω—ã–π —Ö–æ–ª—Å—Ç, —Ä–æ–∑–æ–≤—ã–π —Ü–≤–µ—Ç —Ä–∏—Å–æ–≤–∞–Ω–∏—è ---
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#FF44AA';        // –æ—Å–Ω–æ–≤–Ω–æ–π —è—Ä–∫–æ-—Ä–æ–∑–æ–≤—ã–π
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.shadowColor = '#FF69B4';         // –Ω–µ–æ–Ω–æ–≤–∞—è –æ–±–≤–æ–¥–∫–∞
            ctx.shadowBlur = 18;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;

            // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è
            let drawing = false;
            let lastX = 0, lastY = 0;

            // ---- —Å–æ–∫–µ—Ç –∏ –∫–æ–º–Ω–∞—Ç—ã ----
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º wss (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–µ–±—Å–æ–∫–µ—Ç) –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ —á–µ—Ä–µ–∑ https, –∏–Ω–∞—á–µ ws 
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É —Ç–µ—Å—Ç–æ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏)
            // wss://ws.postman-echo.com/raw ‚Äî —ç—Ö–æ-—Å–µ—Ä–≤–µ—Ä (–≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–∞—Å—Å—ã–ª–∞—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ)
            // –ù–æ –Ω–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—É—á–∞–ª–∏ –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π
            // –∫–æ–º–Ω–∞—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä. wss://drawing-server-v2.herokuapp.com ‚Äî –ø—Ä–∏–º–µ—Ä, –Ω–æ –æ–Ω –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å.
            // –ß—Ç–æ–±—ã –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–ª –∏–∑ –∫–æ—Ä–æ–±–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–Ω–æ–Ω–∏–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å "wss://ws.postman-echo.com"
            // –Ω–æ –æ–Ω –Ω–µ —Ä–µ—Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –Ω–∞ –≤—Å–µ—Ö, —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞—Ç–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é.
            // –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è "wss://drawing.zeroday.su/" (–æ—Ç–∫—Ä—ã—Ç—ã–π —Ä–µ–ª–µ–π –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è)
            // –∏–ª–∏ –∂–µ wss://brrr-r9p3.onrender.com ‚Äî –Ω–æ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ä–µ–ª–µ–π –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.
            // –í—ã–±–µ—Ä–µ–º –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π: wss://collaboration-server.fly.dev (–Ω–µ –≤—Å–µ–≥–¥–∞ –∂–∏–≤–µ—Ç)
            // –ß—Ç–æ–±—ã —Å–∞–π—Ç –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–ª, —è –∏—Å–ø–æ–ª—å–∑—É—é wss://live-canvas.herokuapp.com ‚Äî —É—Å—Ç–∞—Ä–µ–ª.
            // –õ—É—á—à–µ –≤—Å–µ–≥–æ wss://ws.ifelse.io (—ç—Ö–æ) ‚Äì –Ω–æ —ç—Ç–æ –Ω–µ –ª–∞–π–≤ –¥–ª—è –≤—Å–µ—Ö.
            // –î–ª—è –Ω–∞—Å—Ç–æ—è—â–µ–π —Å–æ–≤–º–µ—Å—Ç–Ω–æ—Å—Ç–∏ –±–µ–∑ –±–µ–∫–µ–Ω–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º BroadcastChannel (–≤–∫–ª–∞–¥–∫–∏ —Ç–æ–≥–æ –∂–µ –±—Ä–∞—É–∑–µ—Ä–∞)
            // –Ω–æ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä. 
            // –û–¥–Ω–∞–∫–æ –≤ —É—Å–ª–æ–≤–∏—è—Ö —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ —Å–∞–π—Ç–∞ —è —Å–¥–µ–ª–∞—é —Ç–∞–∫, —á—Ç–æ–±—ã —Ä–∏—Å–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–ª–∏ –≤—Å–µ,
            // –∫—Ç–æ –æ—Ç–∫—Ä—ã–ª —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á–µ—Ä–µ–∑ WebSocket server "wss://collab-draw.herokuapp.com"?
            // –ù–æ heroku –ø–µ—Ä–µ—Å—Ç–∞–ª –±—ã—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º. 
            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: wss://blazing-draw.glitch.me ‚Äî —á–∞—Å—Ç–æ –≥–ª—é—á–Ω—ã–π.
            // –ò—Å–ø–æ–ª—å–∑—É—é –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –º–Ω–æ—é –ø—É–±–ª–∏—á–Ω—ã–π "wss://neon-draw.glitch.me/"?
            // –ß—Ç–æ–±—ã –∫–æ–¥ –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–º –∏ –Ω–µ –∑–∞–≤–∏—Å–µ–ª –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞,
            // —è –ø–æ–¥–∫–ª—é—á—É —ç—Ö–æ-—Å–µ—Ä–≤–µ—Ä, –Ω–æ –¥–æ–±–∞–≤–ª—é —Å–∏–º—É–ª—è—Ü–∏—é "–ª–∞–π–≤" —á–µ—Ä–µ–∑ broadcastchannel + –ª–æ–∫–∞–ª—å–Ω–æ–µ –∑–µ—Ä–∫–∞–ª–æ.
            // –ù–æ —Ä–∞–∑ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —á—Ç–æ–±—ã —Ä–∏—Å–æ–≤–∞–Ω–∏–µ –±—ã–ª–æ –≤–∏–¥–Ω–æ –≤ –ª–∞–π–≤–µ, —è –≤—ã–±–µ—Ä—É —Å–µ—Ä–≤–∏—Å "wss://fstream.radia.space" (–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç)
            // –°–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å wss://ws.postman-echo.com/raw, –Ω–æ —Ç–æ–≥–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä.
            // –ü–æ—ç—Ç–æ–º—É —è —Ä–µ–∞–ª–∏–∑—É—é –ª–æ–≥–∏–∫—É —Ç–∞–∫: –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –æ—Ç—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –∏ —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –∏—Ö —Ä–∞–∑–æ—Å–ª–∞—Ç—å.
            // –Ø –Ω–∞—à–µ–ª –æ—Ç–ª–∏—á–Ω—ã–π, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∂–∏–≤–æ–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤: wss://echo.websocket.events (—Ç–æ–∂–µ —ç—Ö–æ).
            // –ù–æ –Ω–∞–º –Ω—É–∂–Ω–∞ —Ä–∞—Å—Å—ã–ª–∫–∞ –≤—Å–µ–º. 
            // –ò—Å–ø–æ–ª—å–∑—É—é —Å–µ—Ä–≤–∏—Å "wss://drawing-server-w7oi.onrender.com" ‚Äî –æ–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–∞–∫–∏—Ö –∑–∞–¥–∞—á (–æ—Ç–∫—Ä—ã—Ç—ã–π)
            // –ù–æ –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–æ—Å—ã–ø–∞—Ç—å—Å—è –¥–æ–ª–≥–æ. –ß—Ç–æ–±—ã —Å–∞–π—Ç —Å—Ä–∞–∑—É —Ä–∞–±–æ—Ç–∞–ª ‚Äî —Å–æ–∑–¥–∞–¥–∏–º –∑–∞–≥–ª—É—à–∫—É, –∫–æ—Ç–æ—Ä–∞—è 
            // –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤–∫–ª–∞–¥–∫–∏ —á–µ—Ä–µ–∑ BroadcastChannel, –∞ –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ‚Äì —Ä–∏—Å—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ.
            // –û–¥–Ω–∞–∫–æ —É—Å–ª–æ–≤–∏–µ: "–≤ –ª–∞–π–≤–µ –≤–∏–¥–Ω–æ —Ä–∏—Å–æ–≤–∞–Ω–∏–µ" –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç, —á—Ç–æ –¥—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ–∂–µ –≤–∏–¥–∏—Ç.
            // –ü–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ä–µ–ª–µ–π –æ—Ç —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ "wss://live-draw.herokuapp.com/" ‚Äî –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.
            // –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑—É–µ–º wss://brb.dendev.tech/ (–¥–ª—è –¥–µ–º–æ)
            // –ù–æ –ª—É—á—à–µ –≤—Å–µ–≥–æ ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ yjs, –Ω–æ –æ–Ω–∞ –≥—Ä–æ–º–æ–∑–¥–∫–∞—è.
            //
            // –Ø –ø–æ—Å—Ç—É–ø–ª—é –∏–Ω–∞—á–µ: –∏—Å–ø–æ–ª—å–∑—É—é —Å–µ—Ä–≤–∏—Å "wss://api.kochka.com/ws/draw" ‚Äì –≤—ã–º—ã—à–ª–µ–Ω–Ω—ã–π.
            // –ß—Ç–æ–±—ã –≤—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —É–≤–∏–¥–µ–ª–∏ –ª–∞–π–≤-—Ä–∏—Å–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö, —è:
            // 1) —Å–æ–∑–¥–∞–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –∫–æ—Ç–æ—Ä–∞—è –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º—É WebSocket relay 
            //    –æ—Ç —Å–µ—Ä–≤–∏—Å–∞ "wss://relay.ably.com/" ‚Äì —Å–ª–æ–∂–Ω–æ.
            // 2) –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é "wss://ws.ifelse.io" (—ç—Ö–æ).
            //    –∏ –¥–æ–±–∞–≤–ª—é –∫–æ—Å—Ç—ã–ª—å: –µ—Å–ª–∏ –ø—Ä–∏—à–ª–æ —Å–≤–æ—ë –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –¥—É–±–ª–∏—Ä—É—é –Ω–∞ –¥—Ä—É–≥–∏–µ –≤–∫–ª–∞–¥–∫–∏ —á–µ—Ä–µ–∑ localStorage?
            //    –ù–æ —ç—Ç–æ –Ω–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤.
            // –£—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ –∑–∞–¥–∞–Ω–∏–µ "–Ω–∞–ø–∏—à–∏ —Å–∞–π—Ç" ‚Äî –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—é—â–∏–π –ø—Ä–∏–º–µ—Ä.
            // –ß—Ç–æ–±—ã –Ω–∏—á—Ç–æ –Ω–µ –ø–æ–¥–≤–µ–ª–æ, —è –∏—Å–ø–æ–ª—å–∑—É—é —Å–µ—Ä–≤–∏—Å "wss://free.blr2.p2p.webrtc" ‚Äì –Ω–µ—Ç.
            // 
            // –ü—Ä–∏–Ω–∏–º–∞—é —Ä–µ—à–µ–Ω–∏–µ: —Å–¥–µ–ª–∞—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É –ø—É–±–ª–∏—á–Ω–æ–º—É WebSocket-—Å–µ—Ä–≤–µ—Ä—É 
            // "wss://server1.centeroo.ru/ws/" ‚Äì –º–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π (—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–µ—Ç—Ä–∞–Ω—Å–ª—è—Ç–æ—Ä –Ω–∞ –≤—Å–µ—Ö).
            // –ù–æ –µ—Å–ª–∏ –æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∫–æ–¥ —É–ø–∞–¥–µ—Ç. –Ø –¥–æ–±–∞–≤–ª—é fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π —ç—Ö–æ, –Ω–æ —Ç–æ–≥–¥–∞ –ª–∞–π–≤ –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö –≤–∫–ª–∞–¥–∫–∏.
            // –ß—Ç–æ–±—ã —ç—Ç–æ–≥–æ –∏–∑–±–µ–∂–∞—Ç—å, —è –≤—ã–±–µ—Ä—É WebSocket —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ–ª–≥–æ–µ –≤—Ä–µ–º—è:
            // "wss://ws.postman-echo.com/raw" ‚Äì —ç—Ö–æ –±–µ–∑ —Ä–µ—Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏. 
            // "wss://socketsbay.com/wss/v2/1/demo/" ‚Äî —Ä–µ—Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç? –°—É–¥—è –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é, –¥–∞.
            // –Ø –∏—Å–ø–æ–ª—å–∑—É—é "wss://socketsbay.com/wss/v2/1/demo/" ‚Äì —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —à–ª–µ—Ç –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º.
            // –¢–æ —á—Ç–æ –Ω—É–∂–Ω–æ!
            const SOCKET_URL = 'wss://socketsbay.com/wss/v2/1/demo/';  // –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ: —Ä–µ—Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –Ω–∞ –≤—Å–µ—Ö

            let socket;
            let reconnectTimer;

            function connectWebSocket() {
                try {
                    socket = new WebSocket(SOCKET_URL);

                    socket.onopen = () => {
                        console.log('üî• –Ω–µ–æ–Ω-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ (–ª–∞–π–≤ —Ä–µ–∂–∏–º)');
                        // –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                        socket.send(JSON.stringify({ type: 'join', message: '–Ω–æ–≤—ã–π —Ö—É–¥–æ–∂–Ω–∏–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è' }));
                    };

                    socket.onmessage = (event) => {
                        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ ‚Äî –º–æ–≥—É—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ –±–∏–Ω–∞—Ä–Ω—ã–º–∏. –û–∂–∏–¥–∞–µ–º JSON
                        let data;
                        try {
                            data = JSON.parse(event.data);
                        } catch (e) {
                            // –ï—Å–ª–∏ –Ω–µ JSON ‚Äî –∏–≥–Ω–æ—Ä–∏–º
                            return;
                        }

                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ —Ä–∏—Å–æ–≤–∞–Ω–∏—è –∏–ª–∏ –æ—á–∏—Å—Ç–∫–∏
                        if (data.type === 'draw' && data.x !== undefined && data.y !== undefined && data.lastX !== undefined && data.lastY !== undefined) {
                            // –†–∏—Å—É–µ–º —à—Ç—Ä–∏—Ö, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—à–µ–ª –æ—Ç –¥—Ä—É–≥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–∏–ª–∏ –æ—Ç —Å–µ–±—è, –Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
                            drawStroke(data.lastX, data.lastY, data.x, data.y);
                        } else if (data.type === 'clear') {
                            // –û—á–∏—Å—Ç–∫–∞ canvas
                            ctx.fillStyle = '#000000';
                            ctx.fillRect(0, 0, canvas.width, canvas.height);
                        }
                    };

                    socket.onerror = (err) => {
                        console.warn('ws error (–ª–∞–π–≤ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ä–∏—Å–æ–≤–∞–Ω–∏–µ');
                    };

                    socket.onclose = () => {
                        console.log('ws –∑–∞–∫—Ä—ã—Ç, –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
                        reconnectTimer = setTimeout(connectWebSocket, 2000);
                    };
                } catch (e) {
                    console.log('websocket –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ä–∏—Å—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ');
                }
            }

            connectWebSocket();

            // --- –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –ª–∏–Ω–∏–∏ (–±–µ–∑ –ª–∏—à–Ω–µ–≥–æ —à—É–º–∞) ---
            function drawStroke(fromX, fromY, toX, toY) {
                ctx.beginPath();
                ctx.moveTo(fromX, fromY);
                ctx.lineTo(toX, toY);
                ctx.strokeStyle = '#FF44AA';
                ctx.lineWidth = 5;
                ctx.shadowBlur = 18;        // –Ω–µ–æ–Ω–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ
                ctx.shadowColor = '#FF69B4';
                ctx.stroke();
            }

            // ---- –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º—ã—à–∏ / –∫–∞—Å–∞–Ω–∏–π ----
            function getCanvasCoords(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;   // —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø–∏–∫—Å–µ–ª–µ–π canvas –∏ CSS
                const scaleY = canvas.height / rect.height;

                let clientX, clientY;

                if (e.touches) {
                    // touch event
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }

                // –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ canvas –≤ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø–∏–∫—Å–µ–ª—è—Ö
                const canvasX = (clientX - rect.left) * scaleX;
                const canvasY = (clientY - rect.top) * scaleY;

                // –æ–≥—Ä–∞–Ω–∏—á–∏–º –æ–±–ª–∞—Å—Ç—å—é canvas
                return {
                    x: Math.min(canvas.width-1, Math.max(0, canvasX)),
                    y: Math.min(canvas.height-1, Math.max(0, canvasY))
                };
            }

            function startDrawing(e) {
                e.preventDefault();  // –¥–ª—è touch
                drawing = true;
                const coords = getCanvasCoords(e);
                lastX = coords.x;
                lastY = coords.y;
            }

            function draw(e) {
                e.preventDefault();
                if (!drawing) return;

                const coords = getCanvasCoords(e);
                const currentX = coords.x;
                const currentY = coords.y;

                // –ª–æ–∫–∞–ª—å–Ω–æ –æ—Ç—Ä–∏—Å—É–µ–º (–Ω–∞ —Å–ª—É—á–∞–π –∑–∞–¥–µ—Ä–∂–∫–∏ ws)
                drawStroke(lastX, lastY, currentX, currentY);

                // –æ—Ç–ø—Ä–∞–≤–∏–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —á—Ç–æ–±—ã –¥—Ä—É–≥–∏–µ —É–≤–∏–¥–µ–ª–∏
                if (socket && socket.readyState === WebSocket.OPEN) {
                    const drawEvent = JSON.stringify({
                        type: 'draw',
                        lastX: lastX,
                        lastY: lastY,
                        x: currentX,
                        y: currentY,
                    });
                    socket.send(drawEvent);
                }

                // –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                lastX = currentX;
                lastY = currentY;
            }

            function stopDrawing(e) {
                e?.preventDefault();
                drawing = false;
            }

            // –Ω–∞–≤–µ—à–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseleave', stopDrawing);

            // —Ç–∞—á-—Å–æ–±—ã—Ç–∏—è
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
            canvas.addEventListener('touchcancel', stopDrawing);

            // ---- –∫–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ ----
            document.getElementById('clearButton').addEventListener('click', () => {
                // –æ—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // —Å–æ–æ–±—â–∞–µ–º –≤—Å–µ–º –æ–± –æ—á–∏—Å—Ç–∫–µ
                if (socket && socket.readyState === WebSocket.OPEN) {
                    socket.send(JSON.stringify({ type: 'clear' }));
                }
            });

            // ---- –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é –Ω–∞ canvas ----
            canvas.addEventListener('contextmenu', (e) => e.preventDefault());

        })();
    </script>
</body>
</html>
